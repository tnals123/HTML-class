<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/vs2015.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</head>

    <script>
    
        function update_code() {
            const result_elem = document.querySelector("#highlighting-code code");
            const text = document.querySelector("#editing-code").value;
            let html = hljs.highlightAuto(text).value;
            result_elem.innerHTML =  html.replace(new RegExp("  ", "g"), "&nbsp; ");;
        }

        function resize() {
            const editor = document.querySelector('#editing-code');
            editor.style.height = "20px";
            editor.style.height = (editor.scrollHeight + 5)+"px";
        }

        document.addEventListener("DOMContentLoaded", () => {
            update_code();
            resize();
            });

        function insertTextAtCursor(text) {
            var el = document.getElementById("editing-code");
            var val = el.value, endIndex, range, doc = el.ownerDocument;
            if (typeof el.selectionStart == "number"
                    && typeof el.selectionEnd == "number") {
                endIndex = el.selectionEnd;
                el.value = val.slice(0, endIndex) + text + val.slice(endIndex);
                el.selectionStart = el.selectionEnd = endIndex + text.length;
            } else if (doc.selection != "undefined" && doc.selection.createRange) {
                el.focus();
                range = doc.selection.createRange();
                range.collapse(false);
                range.text = text;
                range.select();
            }
        }

        function addText(addString) {
            var element     =         document.getElementById('editing-code');
            var strOriginal  =         element.value;
            var iStartPos    =         element.selectionStart;
            var iEndPos     =         element.selectionEnd;
            var strFront     =         "";
            var strEnd       =         "";

            if(iStartPos == iEndPos) {
            strFront = strOriginal.substring(0, iStartPos);
            strEnd = strOriginal.substring(iStartPos, strOriginal.length);
            } else return;
            element.value = strFront + addString + strEnd;
            }

        function createSelection() {
            var field     =         document.getElementById('editing-code');
            if( field.createTextRange ) {
                var selRange = field.createTextRange();
                selRange.collapse(true);
                selRange.moveStart('ㅤ');
                selRange.moveEnd('ㅤ');
                selRange.select();
                field.focus();
            } else if( field.setSelectionRange ) {
                field.focus();
                field.setSelectionRange(start, end);
            } else if( typeof field.selectionStart != 'undefined' ) {
                field.selectionStart = start;
                field.selectionEnd = end;
                field.focus();
            }
        }


        window.onload = function showAndroidToast() {
            var mywidth = Android.getwidth();
            var px = Android.getwidth(mywidth);
            var mypx = px - 29;
            var mypx_codeblcok = px - 32;
            Android.showToast(String(mypx));
            var transe = document.getElementById("editing-code");
            var code_block = document.getElementById("highlighting-code")
            transe.style.width = mypx+"px";
            code_block.style.width = mypx_codeblcok+"px";
            document.getElementById(id).width = newContent;
        }

        var exam_script = {
        plus_num: function(num){
            try{
                window.java.getNum(num+num);
            }catch(err){
                console.log(">> [exam_script.plus_num()] " + err);
            }
        }
    }



        
    </script>

<body style="margin: 0;">
    <div style="border: 1px solid gray; border-radius: 3dp; height: fit-content; width: fit-content;" >
        <div style="border-bottom: 1px solid gray ;height:fit-content ;">
            <input type="button" style="height: 30px; margin-top: 5px; margin-left: 5px;" onclick="addText('ㅤasdfㅤ'); createSelection();">
            <input type="button" style="height: 30px; margin-top: 5px; margin-left: 5px;">
            <input type="button" style="height: 30px; margin-top: 5px; margin-left: 5px;">
            <input type="button" style="height: 30px; margin-top: 5px; margin-left: 5px;">
            <div style=" position:absolute; display: inline-block; top: 0; bottom: 0; width: 10px; background-color: gray; height: 7%; margin-left: 10px;"></div>
        
        </div>
        <textarea
        id="editing-code"
        placeholder="소스코드 입력"
        spellcheck="false"
        style="min-height:200px; max-height: 200px; width:1000px; top: 10px; resize: none; overflow: scroll; margin : 0  "
        onclick="update_code(); resize(); showAndroidToast()"
        oninput="update_code(); resize();">
# 클릭 시 코드창이 뜹니다. 바로 입력해 주세요
        
print('Hello, world!')
        </textarea>
    </div>
  <pre
  style="height:300px;width:600px;top: 10px;"
  id="highlighting-code"
  class="hljs">
  <code></code>
</pre>
    

</body>
</html>